{
  "title": "Next.js + Docker + Github Action + GCP를 활용한 CI/CD 자동화",
  "date": "2023-11-24",
  "description": "CI/CD 자동화",
  "tag": "React",
  "body": {
    "raw": "\n### Next.js + Docker + Github Action + GCP를 활용한 CI/CD 자동화\n\nnext.js 프로젝트를 배포하려면 기존에는 vercel을 이용해서 쉽게 배포할 수 있었지만, 개인이 아닌 단체로 사용하는 경우 요금이 엄청나기 때문에 만약, 사내에서 next 프로젝트를 배포하게 되면 돈이 낭비될 것이라고 생각했다.\n\n그래서 vercel이 아니라 다른 방법으로 CI/CD를 구축하는 방법을 찾던 중, 이전부터 도커와 github action을 이용해서 배포해보고 싶다는 생각이 들어서 해봤다.\n\n만약 next가 아닌 순수 react 프로젝트라면 Nginx를 이용해야했지만, next는 serverless이기 때문에 별도로 nginx를 사용하지 않아도 된다.\n\n개인 사내 서버에 배포하기보단 테스트 겸 사이드 프로젝트에 사용하기 위해서는 외부(집)에서도 접근이 용이 해야하기 때문에, 개인 GCP (Google Cloud Platform)을 이용했다.\n\n우선 docker을 사용하기 위해선, dockerfile을 만들어줘야한다.\n\n```yml\nFROM node:18 AS builder\n\n# Set working directory\nWORKDIR /app\n\n# Copy package.json and yarn.lock for utilising Docker cache\nCOPY package.json yarn.lock ./\n\n# Install dependencies\nRUN yarn install --frozen-lockfile\n\n# Copy the rest of your app's source code\nCOPY . .\n\n# Build app\nRUN yarn build\n\n# ---- Run Stage ----\nFROM node:18 AS runner\n\n# Set working directory\nWORKDIR /app\n\n# Copy over the artifacts from the build stage\n# COPY --from=builder /app ./\nCOPY --from=builder /app/.next/standalone ./\nCOPY --from=builder /app/.next/static ./.next/static\nCOPY --from=builder /app/public ./public\nCOPY --from=builder /app/node_modules ./node_modules\nCOPY --from=builder /app/package.json ./package.json\n# Start app\nCMD [\"sh\", \"-c\", \"yarn start -p $PORT\"]\n\n```\n\n---\n\nnode 18버전을 사용했고, 유동적으로 포트를 받기 위해서 위에처럼 변수로 받아서 실행할 수 있게 해줬다.\n\n자세히 보면, COPY --from=builder /app/.next/standalone ./라는 명렁어가 있는데,\n\n```ts\n/** @type {import('next').NextConfig} */\nconst nextConfig = {\n  output: 'standalone',\n};\n\nmodule.exports = nextConfig;\n```\n\n---\n\nnext.config 설정에서 standalone를 해줬기 때문이다. 해당 설정을 해주면 도커 파일이 작아져 배포하는 시간 줄어든다.\n\n```yml\n# .dockerignore\n\nnode_modules\n.next\ndockerfile\n.dockerignore\n.git\n.gitignore\nREADME.md\n```\n\n---\n\n그리고 dockerignore를 이용해서 도커파일에 포함하지 않을 파일들을 입력해준다.\n\n```yml\n\nname: CI/CD workflow\n\non:\npush:\nbranches: [main]\n\njobs:\nbuild-and-deploy:\nruns-on: ubuntu-latest\n\n    steps:\n      - name: Check out code\n        uses: actions/checkout@v2\n\n      - name: Set up Docker Buildx\n        uses: docker/setup-buildx-action@v1\n\n      - name: Login to Google Container Registry\n        uses: docker/login-action@v1\n        with:\n          registry: gcr.io\n          username: _json_key\n          password: ${{ secrets.GCR_JSON_KEY }}\n\n      - name: Build and push Docker image\n        uses: docker/build-push-action@v2\n        with:\n          context: .\n          push: true\n          tags: gcr.io/${{ secrets.GCR_ID }}/petmunity-fe:latest\n\n      - name: Setup Google Cloud SDK\n        uses: google-github-actions/setup-gcloud@v0.3.0\n        with:\n          project_id: ${{ secrets.GCR_ID }} # 여기에 Google Cloud 프로젝트 ID를 입력하세요.\n          service_account_key: ${{ secrets.GCR_JSON_KEY }}\n          export_default_credentials: true\n\n      - name: Deploy to Google Cloud Run\n        run: |\n          gcloud run deploy petmunity-fe --image gcr.io/${{ secrets.GCR_ID }}/petmunity-fe:latest --region asia-northeast1 --platform managed --allow-unauthenticated\n\n```\n\n---\n\n다음으로 github action을 사용하기위한 yml이다.\n\nmain 브랜치로 푸시되거나 머지되면 배포가 되야하기 때문에\n\npush: branches: [main]를 입력해줬다.\n\nGoogle Cloud를 이용했기 때문에 Google Cloud SDK를 추가해주는 부분도 입력해주었다.\n\n해당 코드를 이용해서 main 브랜치로 올리게 되면 자동 배포가 가능하게 된다.\n\n기존에는 vercel을 이용해서 배포만 했어서 너무 편했지만, 해당 실습을 하면서 도커와 github action이 어떤 식으로 작동하는 지 알게 되는 좋은 경험이었다.\n",
    "code": "var Component=(()=>{var ln=Object.create;var U=Object.defineProperty;var cn=Object.getOwnPropertyDescriptor;var dn=Object.getOwnPropertyNames;var fn=Object.getPrototypeOf,mn=Object.prototype.hasOwnProperty;var K=(c,t)=>()=>(t||c((t={exports:{}}).exports,t),t.exports),pn=(c,t)=>{for(var b in t)U(c,b,{get:t[b],enumerable:!0})},ye=(c,t,b,h)=>{if(t&&typeof t==\"object\"||typeof t==\"function\")for(let k of dn(t))!mn.call(c,k)&&k!==b&&U(c,k,{get:()=>t[k],enumerable:!(h=cn(t,k))||h.enumerable});return c};var gn=(c,t,b)=>(b=c!=null?ln(fn(c)):{},ye(t||!c||!c.__esModule?U(b,\"default\",{value:c,enumerable:!0}):b,c)),bn=c=>ye(U({},\"__esModule\",{value:!0}),c);var xe=K((Cn,Ce)=>{Ce.exports=React});var De=K(z=>{\"use strict\";(function(){\"use strict\";var c=xe(),t=Symbol.for(\"react.element\"),b=Symbol.for(\"react.portal\"),h=Symbol.for(\"react.fragment\"),k=Symbol.for(\"react.strict_mode\"),q=Symbol.for(\"react.profiler\"),X=Symbol.for(\"react.provider\"),H=Symbol.for(\"react.context\"),R=Symbol.for(\"react.forward_ref\"),B=Symbol.for(\"react.suspense\"),F=Symbol.for(\"react.suspense_list\"),O=Symbol.for(\"react.memo\"),A=Symbol.for(\"react.lazy\"),Oe=Symbol.for(\"react.offscreen\"),J=Symbol.iterator,Pe=\"@@iterator\";function Te(e){if(e===null||typeof e!=\"object\")return null;var n=J&&e[J]||e[Pe];return typeof n==\"function\"?n:null}var C=c.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function m(e){{for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];we(\"error\",e,r)}}function we(e,n,r){{var a=C.ReactDebugCurrentFrame,s=a.getStackAddendum();s!==\"\"&&(n+=\"%s\",r=r.concat([s]));var l=r.map(function(i){return String(i)});l.unshift(\"Warning: \"+n),Function.prototype.apply.call(console[e],console,l)}}var Se=!1,je=!1,Ue=!1,Be=!1,Fe=!1,Z;Z=Symbol.for(\"react.module.reference\");function Ae(e){return!!(typeof e==\"string\"||typeof e==\"function\"||e===h||e===q||Fe||e===k||e===B||e===F||Be||e===Oe||Se||je||Ue||typeof e==\"object\"&&e!==null&&(e.$$typeof===A||e.$$typeof===O||e.$$typeof===X||e.$$typeof===H||e.$$typeof===R||e.$$typeof===Z||e.getModuleId!==void 0))}function Ie(e,n,r){var a=e.displayName;if(a)return a;var s=n.displayName||n.name||\"\";return s!==\"\"?r+\"(\"+s+\")\":r}function Q(e){return e.displayName||\"Context\"}function _(e){if(e==null)return null;if(typeof e.tag==\"number\"&&m(\"Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue.\"),typeof e==\"function\")return e.displayName||e.name||null;if(typeof e==\"string\")return e;switch(e){case h:return\"Fragment\";case b:return\"Portal\";case q:return\"Profiler\";case k:return\"StrictMode\";case B:return\"Suspense\";case F:return\"SuspenseList\"}if(typeof e==\"object\")switch(e.$$typeof){case H:var n=e;return Q(n)+\".Consumer\";case X:var r=e;return Q(r._context)+\".Provider\";case R:return Ie(e,e.render,\"ForwardRef\");case O:var a=e.displayName||null;return a!==null?a:_(e.type)||\"Memo\";case A:{var s=e,l=s._payload,i=s._init;try{return _(i(l))}catch{return null}}}return null}var y=Object.assign,N=0,ee,ne,re,te,ae,oe,ie;function ue(){}ue.__reactDisabledLog=!0;function Ye(){{if(N===0){ee=console.log,ne=console.info,re=console.warn,te=console.error,ae=console.group,oe=console.groupCollapsed,ie=console.groupEnd;var e={configurable:!0,enumerable:!0,value:ue,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}N++}}function $e(){{if(N--,N===0){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:y({},e,{value:ee}),info:y({},e,{value:ne}),warn:y({},e,{value:re}),error:y({},e,{value:te}),group:y({},e,{value:ae}),groupCollapsed:y({},e,{value:oe}),groupEnd:y({},e,{value:ie})})}N<0&&m(\"disabledDepth fell below zero. This is a bug in React. Please file an issue.\")}}var I=C.ReactCurrentDispatcher,Y;function P(e,n,r){{if(Y===void 0)try{throw Error()}catch(s){var a=s.stack.trim().match(/\\n( *(at )?)/);Y=a&&a[1]||\"\"}return`\n`+Y+e}}var $=!1,T;{var Ge=typeof WeakMap==\"function\"?WeakMap:Map;T=new Ge}function se(e,n){if(!e||$)return\"\";{var r=T.get(e);if(r!==void 0)return r}var a;$=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var l;l=I.current,I.current=null,Ye();try{if(n){var i=function(){throw Error()};if(Object.defineProperty(i.prototype,\"props\",{set:function(){throw Error()}}),typeof Reflect==\"object\"&&Reflect.construct){try{Reflect.construct(i,[])}catch(v){a=v}Reflect.construct(e,[],i)}else{try{i.call()}catch(v){a=v}e.call(i.prototype)}}else{try{throw Error()}catch(v){a=v}e()}}catch(v){if(v&&a&&typeof v.stack==\"string\"){for(var o=v.stack.split(`\n`),p=a.stack.split(`\n`),d=o.length-1,f=p.length-1;d>=1&&f>=0&&o[d]!==p[f];)f--;for(;d>=1&&f>=0;d--,f--)if(o[d]!==p[f]){if(d!==1||f!==1)do if(d--,f--,f<0||o[d]!==p[f]){var g=`\n`+o[d].replace(\" at new \",\" at \");return e.displayName&&g.includes(\"<anonymous>\")&&(g=g.replace(\"<anonymous>\",e.displayName)),typeof e==\"function\"&&T.set(e,g),g}while(d>=1&&f>=0);break}}}finally{$=!1,I.current=l,$e(),Error.prepareStackTrace=s}var D=e?e.displayName||e.name:\"\",he=D?P(D):\"\";return typeof e==\"function\"&&T.set(e,he),he}function Me(e,n,r){return se(e,!1)}function We(e){var n=e.prototype;return!!(n&&n.isReactComponent)}function w(e,n,r){if(e==null)return\"\";if(typeof e==\"function\")return se(e,We(e));if(typeof e==\"string\")return P(e);switch(e){case B:return P(\"Suspense\");case F:return P(\"SuspenseList\")}if(typeof e==\"object\")switch(e.$$typeof){case R:return Me(e.render);case O:return w(e.type,n,r);case A:{var a=e,s=a._payload,l=a._init;try{return w(l(s),n,r)}catch{}}}return\"\"}var S=Object.prototype.hasOwnProperty,le={},ce=C.ReactDebugCurrentFrame;function j(e){if(e){var n=e._owner,r=w(e.type,e._source,n?n.type:null);ce.setExtraStackFrame(r)}else ce.setExtraStackFrame(null)}function Ve(e,n,r,a,s){{var l=Function.call.bind(S);for(var i in e)if(l(e,i)){var o=void 0;try{if(typeof e[i]!=\"function\"){var p=Error((a||\"React class\")+\": \"+r+\" type `\"+i+\"` is invalid; it must be a function, usually from the `prop-types` package, but received `\"+typeof e[i]+\"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.\");throw p.name=\"Invariant Violation\",p}o=e[i](n,i,a,r,null,\"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED\")}catch(d){o=d}o&&!(o instanceof Error)&&(j(s),m(\"%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).\",a||\"React class\",r,i,typeof o),j(null)),o instanceof Error&&!(o.message in le)&&(le[o.message]=!0,j(s),m(\"Failed %s type: %s\",r,o.message),j(null))}}}var Le=Array.isArray;function G(e){return Le(e)}function Ke(e){{var n=typeof Symbol==\"function\"&&Symbol.toStringTag,r=n&&e[Symbol.toStringTag]||e.constructor.name||\"Object\";return r}}function ze(e){try{return de(e),!1}catch{return!0}}function de(e){return\"\"+e}function fe(e){if(ze(e))return m(\"The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.\",Ke(e)),de(e)}var E=C.ReactCurrentOwner,qe={key:!0,ref:!0,__self:!0,__source:!0},me,pe,M;M={};function Xe(e){if(S.call(e,\"ref\")){var n=Object.getOwnPropertyDescriptor(e,\"ref\").get;if(n&&n.isReactWarning)return!1}return e.ref!==void 0}function He(e){if(S.call(e,\"key\")){var n=Object.getOwnPropertyDescriptor(e,\"key\").get;if(n&&n.isReactWarning)return!1}return e.key!==void 0}function Je(e,n){if(typeof e.ref==\"string\"&&E.current&&n&&E.current.stateNode!==n){var r=_(E.current.type);M[r]||(m('Component \"%s\" contains the string ref \"%s\". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',_(E.current.type),e.ref),M[r]=!0)}}function Ze(e,n){{var r=function(){me||(me=!0,m(\"%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)\",n))};r.isReactWarning=!0,Object.defineProperty(e,\"key\",{get:r,configurable:!0})}}function Qe(e,n){{var r=function(){pe||(pe=!0,m(\"%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)\",n))};r.isReactWarning=!0,Object.defineProperty(e,\"ref\",{get:r,configurable:!0})}}var en=function(e,n,r,a,s,l,i){var o={$$typeof:t,type:e,key:n,ref:r,props:i,_owner:l};return o._store={},Object.defineProperty(o._store,\"validated\",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(o,\"_self\",{configurable:!1,enumerable:!1,writable:!1,value:a}),Object.defineProperty(o,\"_source\",{configurable:!1,enumerable:!1,writable:!1,value:s}),Object.freeze&&(Object.freeze(o.props),Object.freeze(o)),o};function nn(e,n,r,a,s){{var l,i={},o=null,p=null;r!==void 0&&(fe(r),o=\"\"+r),He(n)&&(fe(n.key),o=\"\"+n.key),Xe(n)&&(p=n.ref,Je(n,s));for(l in n)S.call(n,l)&&!qe.hasOwnProperty(l)&&(i[l]=n[l]);if(e&&e.defaultProps){var d=e.defaultProps;for(l in d)i[l]===void 0&&(i[l]=d[l])}if(o||p){var f=typeof e==\"function\"?e.displayName||e.name||\"Unknown\":e;o&&Ze(i,f),p&&Qe(i,f)}return en(e,o,p,s,a,E.current,i)}}var W=C.ReactCurrentOwner,ge=C.ReactDebugCurrentFrame;function x(e){if(e){var n=e._owner,r=w(e.type,e._source,n?n.type:null);ge.setExtraStackFrame(r)}else ge.setExtraStackFrame(null)}var V;V=!1;function L(e){return typeof e==\"object\"&&e!==null&&e.$$typeof===t}function be(){{if(W.current){var e=_(W.current.type);if(e)return`\n\nCheck the render method of \\``+e+\"`.\"}return\"\"}}function rn(e){{if(e!==void 0){var n=e.fileName.replace(/^.*[\\\\\\/]/,\"\"),r=e.lineNumber;return`\n\nCheck your code at `+n+\":\"+r+\".\"}return\"\"}}var _e={};function tn(e){{var n=be();if(!n){var r=typeof e==\"string\"?e:e.displayName||e.name;r&&(n=`\n\nCheck the top-level render call using <`+r+\">.\")}return n}}function ve(e,n){{if(!e._store||e._store.validated||e.key!=null)return;e._store.validated=!0;var r=tn(n);if(_e[r])return;_e[r]=!0;var a=\"\";e&&e._owner&&e._owner!==W.current&&(a=\" It was passed a child from \"+_(e._owner.type)+\".\"),x(e),m('Each child in a list should have a unique \"key\" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',r,a),x(null)}}function ke(e,n){{if(typeof e!=\"object\")return;if(G(e))for(var r=0;r<e.length;r++){var a=e[r];L(a)&&ve(a,n)}else if(L(e))e._store&&(e._store.validated=!0);else if(e){var s=Te(e);if(typeof s==\"function\"&&s!==e.entries)for(var l=s.call(e),i;!(i=l.next()).done;)L(i.value)&&ve(i.value,n)}}}function an(e){{var n=e.type;if(n==null||typeof n==\"string\")return;var r;if(typeof n==\"function\")r=n.propTypes;else if(typeof n==\"object\"&&(n.$$typeof===R||n.$$typeof===O))r=n.propTypes;else return;if(r){var a=_(n);Ve(r,e.props,\"prop\",a,e)}else if(n.PropTypes!==void 0&&!V){V=!0;var s=_(n);m(\"Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?\",s||\"Unknown\")}typeof n.getDefaultProps==\"function\"&&!n.getDefaultProps.isReactClassApproved&&m(\"getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.\")}}function on(e){{for(var n=Object.keys(e.props),r=0;r<n.length;r++){var a=n[r];if(a!==\"children\"&&a!==\"key\"){x(e),m(\"Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.\",a),x(null);break}}e.ref!==null&&(x(e),m(\"Invalid attribute `ref` supplied to `React.Fragment`.\"),x(null))}}function un(e,n,r,a,s,l){{var i=Ae(e);if(!i){var o=\"\";(e===void 0||typeof e==\"object\"&&e!==null&&Object.keys(e).length===0)&&(o+=\" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.\");var p=rn(s);p?o+=p:o+=be();var d;e===null?d=\"null\":G(e)?d=\"array\":e!==void 0&&e.$$typeof===t?(d=\"<\"+(_(e.type)||\"Unknown\")+\" />\",o=\" Did you accidentally export a JSX literal instead of a component?\"):d=typeof e,m(\"React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s\",d,o)}var f=nn(e,n,r,s,l);if(f==null)return f;if(i){var g=n.children;if(g!==void 0)if(a)if(G(g)){for(var D=0;D<g.length;D++)ke(g[D],e);Object.freeze&&Object.freeze(g)}else m(\"React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.\");else ke(g,e)}return e===h?on(f):an(f),f}}var sn=un;z.Fragment=h,z.jsxDEV=sn})()});var Ee=K((Dn,Ne)=>{\"use strict\";Ne.exports=De()});var hn={};pn(hn,{default:()=>kn,frontmatter:()=>_n});var u=gn(Ee()),_n={title:\"Next.js + Docker + Github Action + GCP\\uB97C \\uD65C\\uC6A9\\uD55C CI/CD \\uC790\\uB3D9\\uD654\",date:new Date(1700784e6),description:\"CI/CD \\uC790\\uB3D9\\uD654\",tag:\"React\"};function Re(c){let t=Object.assign({h3:\"h3\",p:\"p\",pre:\"pre\",code:\"code\",hr:\"hr\"},c.components);return(0,u.jsxDEV)(u.Fragment,{children:[(0,u.jsxDEV)(t.h3,{children:\"Next.js + Docker + Github Action + GCP\\uB97C \\uD65C\\uC6A9\\uD55C CI/CD \\uC790\\uB3D9\\uD654\"},void 0,!1,{fileName:\"/Users/duckuengna/Desktop/Coding/Duck-Blog2/duck-blog_v2/posts/_mdx_bundler_entry_point-253732f4-1a71-42b6-9a89-c5a63cde8490.mdx\",lineNumber:8,columnNumber:1},this),`\n`,(0,u.jsxDEV)(t.p,{children:\"next.js \\uD504\\uB85C\\uC81D\\uD2B8\\uB97C \\uBC30\\uD3EC\\uD558\\uB824\\uBA74 \\uAE30\\uC874\\uC5D0\\uB294 vercel\\uC744 \\uC774\\uC6A9\\uD574\\uC11C \\uC27D\\uAC8C \\uBC30\\uD3EC\\uD560 \\uC218 \\uC788\\uC5C8\\uC9C0\\uB9CC, \\uAC1C\\uC778\\uC774 \\uC544\\uB2CC \\uB2E8\\uCCB4\\uB85C \\uC0AC\\uC6A9\\uD558\\uB294 \\uACBD\\uC6B0 \\uC694\\uAE08\\uC774 \\uC5C4\\uCCAD\\uB098\\uAE30 \\uB54C\\uBB38\\uC5D0 \\uB9CC\\uC57D, \\uC0AC\\uB0B4\\uC5D0\\uC11C next \\uD504\\uB85C\\uC81D\\uD2B8\\uB97C \\uBC30\\uD3EC\\uD558\\uAC8C \\uB418\\uBA74 \\uB3C8\\uC774 \\uB0AD\\uBE44\\uB420 \\uAC83\\uC774\\uB77C\\uACE0 \\uC0DD\\uAC01\\uD588\\uB2E4.\"},void 0,!1,{fileName:\"/Users/duckuengna/Desktop/Coding/Duck-Blog2/duck-blog_v2/posts/_mdx_bundler_entry_point-253732f4-1a71-42b6-9a89-c5a63cde8490.mdx\",lineNumber:10,columnNumber:1},this),`\n`,(0,u.jsxDEV)(t.p,{children:\"\\uADF8\\uB798\\uC11C vercel\\uC774 \\uC544\\uB2C8\\uB77C \\uB2E4\\uB978 \\uBC29\\uBC95\\uC73C\\uB85C CI/CD\\uB97C \\uAD6C\\uCD95\\uD558\\uB294 \\uBC29\\uBC95\\uC744 \\uCC3E\\uB358 \\uC911, \\uC774\\uC804\\uBD80\\uD130 \\uB3C4\\uCEE4\\uC640 github action\\uC744 \\uC774\\uC6A9\\uD574\\uC11C \\uBC30\\uD3EC\\uD574\\uBCF4\\uACE0 \\uC2F6\\uB2E4\\uB294 \\uC0DD\\uAC01\\uC774 \\uB4E4\\uC5B4\\uC11C \\uD574\\uBD24\\uB2E4.\"},void 0,!1,{fileName:\"/Users/duckuengna/Desktop/Coding/Duck-Blog2/duck-blog_v2/posts/_mdx_bundler_entry_point-253732f4-1a71-42b6-9a89-c5a63cde8490.mdx\",lineNumber:12,columnNumber:1},this),`\n`,(0,u.jsxDEV)(t.p,{children:\"\\uB9CC\\uC57D next\\uAC00 \\uC544\\uB2CC \\uC21C\\uC218 react \\uD504\\uB85C\\uC81D\\uD2B8\\uB77C\\uBA74 Nginx\\uB97C \\uC774\\uC6A9\\uD574\\uC57C\\uD588\\uC9C0\\uB9CC, next\\uB294 serverless\\uC774\\uAE30 \\uB54C\\uBB38\\uC5D0 \\uBCC4\\uB3C4\\uB85C nginx\\uB97C \\uC0AC\\uC6A9\\uD558\\uC9C0 \\uC54A\\uC544\\uB3C4 \\uB41C\\uB2E4.\"},void 0,!1,{fileName:\"/Users/duckuengna/Desktop/Coding/Duck-Blog2/duck-blog_v2/posts/_mdx_bundler_entry_point-253732f4-1a71-42b6-9a89-c5a63cde8490.mdx\",lineNumber:14,columnNumber:1},this),`\n`,(0,u.jsxDEV)(t.p,{children:\"\\uAC1C\\uC778 \\uC0AC\\uB0B4 \\uC11C\\uBC84\\uC5D0 \\uBC30\\uD3EC\\uD558\\uAE30\\uBCF4\\uB2E8 \\uD14C\\uC2A4\\uD2B8 \\uACB8 \\uC0AC\\uC774\\uB4DC \\uD504\\uB85C\\uC81D\\uD2B8\\uC5D0 \\uC0AC\\uC6A9\\uD558\\uAE30 \\uC704\\uD574\\uC11C\\uB294 \\uC678\\uBD80(\\uC9D1)\\uC5D0\\uC11C\\uB3C4 \\uC811\\uADFC\\uC774 \\uC6A9\\uC774 \\uD574\\uC57C\\uD558\\uAE30 \\uB54C\\uBB38\\uC5D0, \\uAC1C\\uC778 GCP (Google Cloud Platform)\\uC744 \\uC774\\uC6A9\\uD588\\uB2E4.\"},void 0,!1,{fileName:\"/Users/duckuengna/Desktop/Coding/Duck-Blog2/duck-blog_v2/posts/_mdx_bundler_entry_point-253732f4-1a71-42b6-9a89-c5a63cde8490.mdx\",lineNumber:16,columnNumber:1},this),`\n`,(0,u.jsxDEV)(t.p,{children:\"\\uC6B0\\uC120 docker\\uC744 \\uC0AC\\uC6A9\\uD558\\uAE30 \\uC704\\uD574\\uC120, dockerfile\\uC744 \\uB9CC\\uB4E4\\uC5B4\\uC918\\uC57C\\uD55C\\uB2E4.\"},void 0,!1,{fileName:\"/Users/duckuengna/Desktop/Coding/Duck-Blog2/duck-blog_v2/posts/_mdx_bundler_entry_point-253732f4-1a71-42b6-9a89-c5a63cde8490.mdx\",lineNumber:18,columnNumber:1},this),`\n`,(0,u.jsxDEV)(t.pre,{children:(0,u.jsxDEV)(t.code,{className:\"language-yml\",children:`FROM node:18 AS builder\n\n# Set working directory\nWORKDIR /app\n\n# Copy package.json and yarn.lock for utilising Docker cache\nCOPY package.json yarn.lock ./\n\n# Install dependencies\nRUN yarn install --frozen-lockfile\n\n# Copy the rest of your app's source code\nCOPY . .\n\n# Build app\nRUN yarn build\n\n# ---- Run Stage ----\nFROM node:18 AS runner\n\n# Set working directory\nWORKDIR /app\n\n# Copy over the artifacts from the build stage\n# COPY --from=builder /app ./\nCOPY --from=builder /app/.next/standalone ./\nCOPY --from=builder /app/.next/static ./.next/static\nCOPY --from=builder /app/public ./public\nCOPY --from=builder /app/node_modules ./node_modules\nCOPY --from=builder /app/package.json ./package.json\n# Start app\nCMD [\"sh\", \"-c\", \"yarn start -p $PORT\"]\n\n`},void 0,!1,{fileName:\"/Users/duckuengna/Desktop/Coding/Duck-Blog2/duck-blog_v2/posts/_mdx_bundler_entry_point-253732f4-1a71-42b6-9a89-c5a63cde8490.mdx\",lineNumber:20,columnNumber:1},this)},void 0,!1,{fileName:\"/Users/duckuengna/Desktop/Coding/Duck-Blog2/duck-blog_v2/posts/_mdx_bundler_entry_point-253732f4-1a71-42b6-9a89-c5a63cde8490.mdx\",lineNumber:20,columnNumber:1},this),`\n`,(0,u.jsxDEV)(t.hr,{},void 0,!1,{fileName:\"/Users/duckuengna/Desktop/Coding/Duck-Blog2/duck-blog_v2/posts/_mdx_bundler_entry_point-253732f4-1a71-42b6-9a89-c5a63cde8490.mdx\",lineNumber:56,columnNumber:1},this),`\n`,(0,u.jsxDEV)(t.p,{children:\"node 18\\uBC84\\uC804\\uC744 \\uC0AC\\uC6A9\\uD588\\uACE0, \\uC720\\uB3D9\\uC801\\uC73C\\uB85C \\uD3EC\\uD2B8\\uB97C \\uBC1B\\uAE30 \\uC704\\uD574\\uC11C \\uC704\\uC5D0\\uCC98\\uB7FC \\uBCC0\\uC218\\uB85C \\uBC1B\\uC544\\uC11C \\uC2E4\\uD589\\uD560 \\uC218 \\uC788\\uAC8C \\uD574\\uC92C\\uB2E4.\"},void 0,!1,{fileName:\"/Users/duckuengna/Desktop/Coding/Duck-Blog2/duck-blog_v2/posts/_mdx_bundler_entry_point-253732f4-1a71-42b6-9a89-c5a63cde8490.mdx\",lineNumber:58,columnNumber:1},this),`\n`,(0,u.jsxDEV)(t.p,{children:\"\\uC790\\uC138\\uD788 \\uBCF4\\uBA74,\\xA0COPY --from=builder /app/.next/standalone ./\\uB77C\\uB294 \\uBA85\\uB801\\uC5B4\\uAC00 \\uC788\\uB294\\uB370,\"},void 0,!1,{fileName:\"/Users/duckuengna/Desktop/Coding/Duck-Blog2/duck-blog_v2/posts/_mdx_bundler_entry_point-253732f4-1a71-42b6-9a89-c5a63cde8490.mdx\",lineNumber:60,columnNumber:1},this),`\n`,(0,u.jsxDEV)(t.pre,{children:(0,u.jsxDEV)(t.code,{className:\"language-ts\",children:`/** @type {import('next').NextConfig} */\nconst nextConfig = {\n  output: 'standalone',\n};\n\nmodule.exports = nextConfig;\n`},void 0,!1,{fileName:\"/Users/duckuengna/Desktop/Coding/Duck-Blog2/duck-blog_v2/posts/_mdx_bundler_entry_point-253732f4-1a71-42b6-9a89-c5a63cde8490.mdx\",lineNumber:62,columnNumber:1},this)},void 0,!1,{fileName:\"/Users/duckuengna/Desktop/Coding/Duck-Blog2/duck-blog_v2/posts/_mdx_bundler_entry_point-253732f4-1a71-42b6-9a89-c5a63cde8490.mdx\",lineNumber:62,columnNumber:1},this),`\n`,(0,u.jsxDEV)(t.hr,{},void 0,!1,{fileName:\"/Users/duckuengna/Desktop/Coding/Duck-Blog2/duck-blog_v2/posts/_mdx_bundler_entry_point-253732f4-1a71-42b6-9a89-c5a63cde8490.mdx\",lineNumber:71,columnNumber:1},this),`\n`,(0,u.jsxDEV)(t.p,{children:\"next.config \\uC124\\uC815\\uC5D0\\uC11C\\xA0standalone\\uB97C \\uD574\\uC92C\\uAE30 \\uB54C\\uBB38\\uC774\\uB2E4. \\uD574\\uB2F9 \\uC124\\uC815\\uC744 \\uD574\\uC8FC\\uBA74 \\uB3C4\\uCEE4 \\uD30C\\uC77C\\uC774 \\uC791\\uC544\\uC838 \\uBC30\\uD3EC\\uD558\\uB294 \\uC2DC\\uAC04 \\uC904\\uC5B4\\uB4E0\\uB2E4.\"},void 0,!1,{fileName:\"/Users/duckuengna/Desktop/Coding/Duck-Blog2/duck-blog_v2/posts/_mdx_bundler_entry_point-253732f4-1a71-42b6-9a89-c5a63cde8490.mdx\",lineNumber:73,columnNumber:1},this),`\n`,(0,u.jsxDEV)(t.pre,{children:(0,u.jsxDEV)(t.code,{className:\"language-yml\",children:`# .dockerignore\n\nnode_modules\n.next\ndockerfile\n.dockerignore\n.git\n.gitignore\nREADME.md\n`},void 0,!1,{fileName:\"/Users/duckuengna/Desktop/Coding/Duck-Blog2/duck-blog_v2/posts/_mdx_bundler_entry_point-253732f4-1a71-42b6-9a89-c5a63cde8490.mdx\",lineNumber:75,columnNumber:1},this)},void 0,!1,{fileName:\"/Users/duckuengna/Desktop/Coding/Duck-Blog2/duck-blog_v2/posts/_mdx_bundler_entry_point-253732f4-1a71-42b6-9a89-c5a63cde8490.mdx\",lineNumber:75,columnNumber:1},this),`\n`,(0,u.jsxDEV)(t.hr,{},void 0,!1,{fileName:\"/Users/duckuengna/Desktop/Coding/Duck-Blog2/duck-blog_v2/posts/_mdx_bundler_entry_point-253732f4-1a71-42b6-9a89-c5a63cde8490.mdx\",lineNumber:87,columnNumber:1},this),`\n`,(0,u.jsxDEV)(t.p,{children:\"\\uADF8\\uB9AC\\uACE0\\xA0dockerignore\\uB97C \\uC774\\uC6A9\\uD574\\uC11C \\uB3C4\\uCEE4\\uD30C\\uC77C\\uC5D0 \\uD3EC\\uD568\\uD558\\uC9C0 \\uC54A\\uC744 \\uD30C\\uC77C\\uB4E4\\uC744 \\uC785\\uB825\\uD574\\uC900\\uB2E4.\"},void 0,!1,{fileName:\"/Users/duckuengna/Desktop/Coding/Duck-Blog2/duck-blog_v2/posts/_mdx_bundler_entry_point-253732f4-1a71-42b6-9a89-c5a63cde8490.mdx\",lineNumber:89,columnNumber:1},this),`\n`,(0,u.jsxDEV)(t.pre,{children:(0,u.jsxDEV)(t.code,{className:\"language-yml\",children:`\nname: CI/CD workflow\n\non:\npush:\nbranches: [main]\n\njobs:\nbuild-and-deploy:\nruns-on: ubuntu-latest\n\n    steps:\n      - name: Check out code\n        uses: actions/checkout@v2\n\n      - name: Set up Docker Buildx\n        uses: docker/setup-buildx-action@v1\n\n      - name: Login to Google Container Registry\n        uses: docker/login-action@v1\n        with:\n          registry: gcr.io\n          username: _json_key\n          password: \\${{ secrets.GCR_JSON_KEY }}\n\n      - name: Build and push Docker image\n        uses: docker/build-push-action@v2\n        with:\n          context: .\n          push: true\n          tags: gcr.io/\\${{ secrets.GCR_ID }}/petmunity-fe:latest\n\n      - name: Setup Google Cloud SDK\n        uses: google-github-actions/setup-gcloud@v0.3.0\n        with:\n          project_id: \\${{ secrets.GCR_ID }} # \\uC5EC\\uAE30\\uC5D0 Google Cloud \\uD504\\uB85C\\uC81D\\uD2B8 ID\\uB97C \\uC785\\uB825\\uD558\\uC138\\uC694.\n          service_account_key: \\${{ secrets.GCR_JSON_KEY }}\n          export_default_credentials: true\n\n      - name: Deploy to Google Cloud Run\n        run: |\n          gcloud run deploy petmunity-fe --image gcr.io/\\${{ secrets.GCR_ID }}/petmunity-fe:latest --region asia-northeast1 --platform managed --allow-unauthenticated\n\n`},void 0,!1,{fileName:\"/Users/duckuengna/Desktop/Coding/Duck-Blog2/duck-blog_v2/posts/_mdx_bundler_entry_point-253732f4-1a71-42b6-9a89-c5a63cde8490.mdx\",lineNumber:91,columnNumber:1},this)},void 0,!1,{fileName:\"/Users/duckuengna/Desktop/Coding/Duck-Blog2/duck-blog_v2/posts/_mdx_bundler_entry_point-253732f4-1a71-42b6-9a89-c5a63cde8490.mdx\",lineNumber:91,columnNumber:1},this),`\n`,(0,u.jsxDEV)(t.hr,{},void 0,!1,{fileName:\"/Users/duckuengna/Desktop/Coding/Duck-Blog2/duck-blog_v2/posts/_mdx_bundler_entry_point-253732f4-1a71-42b6-9a89-c5a63cde8490.mdx\",lineNumber:137,columnNumber:1},this),`\n`,(0,u.jsxDEV)(t.p,{children:\"\\uB2E4\\uC74C\\uC73C\\uB85C github action\\uC744 \\uC0AC\\uC6A9\\uD558\\uAE30\\uC704\\uD55C yml\\uC774\\uB2E4.\"},void 0,!1,{fileName:\"/Users/duckuengna/Desktop/Coding/Duck-Blog2/duck-blog_v2/posts/_mdx_bundler_entry_point-253732f4-1a71-42b6-9a89-c5a63cde8490.mdx\",lineNumber:139,columnNumber:1},this),`\n`,(0,u.jsxDEV)(t.p,{children:\"main \\uBE0C\\uB79C\\uCE58\\uB85C \\uD478\\uC2DC\\uB418\\uAC70\\uB098 \\uBA38\\uC9C0\\uB418\\uBA74 \\uBC30\\uD3EC\\uAC00 \\uB418\\uC57C\\uD558\\uAE30 \\uB54C\\uBB38\\uC5D0\"},void 0,!1,{fileName:\"/Users/duckuengna/Desktop/Coding/Duck-Blog2/duck-blog_v2/posts/_mdx_bundler_entry_point-253732f4-1a71-42b6-9a89-c5a63cde8490.mdx\",lineNumber:141,columnNumber:1},this),`\n`,(0,u.jsxDEV)(t.p,{children:\"push: branches: [main]\\uB97C \\uC785\\uB825\\uD574\\uC92C\\uB2E4.\"},void 0,!1,{fileName:\"/Users/duckuengna/Desktop/Coding/Duck-Blog2/duck-blog_v2/posts/_mdx_bundler_entry_point-253732f4-1a71-42b6-9a89-c5a63cde8490.mdx\",lineNumber:143,columnNumber:1},this),`\n`,(0,u.jsxDEV)(t.p,{children:\"Google Cloud\\uB97C \\uC774\\uC6A9\\uD588\\uAE30 \\uB54C\\uBB38\\uC5D0\\xA0Google Cloud SDK\\uB97C \\uCD94\\uAC00\\uD574\\uC8FC\\uB294 \\uBD80\\uBD84\\uB3C4 \\uC785\\uB825\\uD574\\uC8FC\\uC5C8\\uB2E4.\"},void 0,!1,{fileName:\"/Users/duckuengna/Desktop/Coding/Duck-Blog2/duck-blog_v2/posts/_mdx_bundler_entry_point-253732f4-1a71-42b6-9a89-c5a63cde8490.mdx\",lineNumber:145,columnNumber:1},this),`\n`,(0,u.jsxDEV)(t.p,{children:\"\\uD574\\uB2F9 \\uCF54\\uB4DC\\uB97C \\uC774\\uC6A9\\uD574\\uC11C main \\uBE0C\\uB79C\\uCE58\\uB85C \\uC62C\\uB9AC\\uAC8C \\uB418\\uBA74 \\uC790\\uB3D9 \\uBC30\\uD3EC\\uAC00 \\uAC00\\uB2A5\\uD558\\uAC8C \\uB41C\\uB2E4.\"},void 0,!1,{fileName:\"/Users/duckuengna/Desktop/Coding/Duck-Blog2/duck-blog_v2/posts/_mdx_bundler_entry_point-253732f4-1a71-42b6-9a89-c5a63cde8490.mdx\",lineNumber:147,columnNumber:1},this),`\n`,(0,u.jsxDEV)(t.p,{children:\"\\uAE30\\uC874\\uC5D0\\uB294 vercel\\uC744 \\uC774\\uC6A9\\uD574\\uC11C \\uBC30\\uD3EC\\uB9CC \\uD588\\uC5B4\\uC11C \\uB108\\uBB34 \\uD3B8\\uD588\\uC9C0\\uB9CC, \\uD574\\uB2F9 \\uC2E4\\uC2B5\\uC744 \\uD558\\uBA74\\uC11C \\uB3C4\\uCEE4\\uC640 github action\\uC774 \\uC5B4\\uB5A4 \\uC2DD\\uC73C\\uB85C \\uC791\\uB3D9\\uD558\\uB294 \\uC9C0 \\uC54C\\uAC8C \\uB418\\uB294 \\uC88B\\uC740 \\uACBD\\uD5D8\\uC774\\uC5C8\\uB2E4.\"},void 0,!1,{fileName:\"/Users/duckuengna/Desktop/Coding/Duck-Blog2/duck-blog_v2/posts/_mdx_bundler_entry_point-253732f4-1a71-42b6-9a89-c5a63cde8490.mdx\",lineNumber:149,columnNumber:1},this)]},void 0,!0,{fileName:\"/Users/duckuengna/Desktop/Coding/Duck-Blog2/duck-blog_v2/posts/_mdx_bundler_entry_point-253732f4-1a71-42b6-9a89-c5a63cde8490.mdx\",lineNumber:1,columnNumber:1},this)}function vn(c={}){let{wrapper:t}=c.components||{};return t?(0,u.jsxDEV)(t,Object.assign({},c,{children:(0,u.jsxDEV)(Re,c,void 0,!1,{fileName:\"/Users/duckuengna/Desktop/Coding/Duck-Blog2/duck-blog_v2/posts/_mdx_bundler_entry_point-253732f4-1a71-42b6-9a89-c5a63cde8490.mdx\"},this)}),void 0,!1,{fileName:\"/Users/duckuengna/Desktop/Coding/Duck-Blog2/duck-blog_v2/posts/_mdx_bundler_entry_point-253732f4-1a71-42b6-9a89-c5a63cde8490.mdx\"},this):Re(c)}var kn=vn;return bn(hn);})();\n/**\n * @license React\n * react-jsx-dev-runtime.development.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n;return Component;"
  },
  "_id": "34.md",
  "_raw": {
    "sourceFilePath": "34.md",
    "sourceFileName": "34.md",
    "sourceFileDir": ".",
    "contentType": "markdown",
    "flattenedPath": "34"
  },
  "type": "Post"
}